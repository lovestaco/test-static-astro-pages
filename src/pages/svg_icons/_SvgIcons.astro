---
import CreditsButton from "@/components/buttons/CreditsButton";
import Pagination from "@/components/PaginationComponent.astro";
import ToolContainer from "@/components/tool/ToolContainer";
import ToolContentCardWrapper from "@/components/tool/ToolContentCardWrapper";
import ToolHead from "@/components/tool/ToolHead";
import { Card } from "@/components/ui/card";
import { formatNumber } from "@/lib/utils";
import { Download, Filter, Star } from "lucide-react";
import AdBanner from "../../components/banner/AdBanner.astro";

// Helper function to get category emoji
const getCategoryEmoji = (categoryName: string): string => {
  const emojiMap: Record<string, string> = {
    'general': 'ğŸ”§',
    'animals': 'ğŸ¾',
    'nature': 'ğŸŒ¿',
    'technology': 'ğŸ’»',
    'business': 'ğŸ’¼',
    'social': 'ğŸ‘¥',
    'shapes': 'ğŸ”·',
    '18': 'ğŸ”',
    'account': 'ğŸ‘¤',
    'ad': 'ğŸ“¢',
    'automation': 'ğŸ¤–',
    'banking': 'ğŸ¦',
    'bitcoin': 'â‚¿',
    'browser': 'ğŸŒ',
    'cloud': 'â˜ï¸',
    'communication': 'ğŸ’¬',
    'database': 'ğŸ—„ï¸',
    'design': 'ğŸ¨',
    'development': 'âš¡',
    'education': 'ğŸ“š',
    'entertainment': 'ğŸ¬',
    'finance': 'ğŸ’°',
    'food': 'ğŸ•',
    'gaming': 'ğŸ®',
    'health': 'ğŸ¥',
    'home': 'ğŸ ',
    'music': 'ğŸµ',
    'navigation': 'ğŸ§­',
    'news': 'ğŸ“°',
    'shopping': 'ğŸ›’',
    'sports': 'âš½',
    'travel': 'âœˆï¸',
    'weather': 'ğŸŒ¤ï¸',
  };

  return emojiMap[categoryName.toLowerCase()] || 'ğŸ”§';
};

// Helper function to render SVG icon preview
function renderIconPreview(categoryName: string, iconName: string, index: number) {
  return `
    <div class="flex items-center justify-center p-1">
      <div class="w-14 h-14 text-slate-600 overflow-hidden flex items-center justify-center">
        <div class="w-14 h-14 flex items-center justify-center bg-slate-100 rounded-lg">
          <img 
            src="/freedevtools/svg_icons/${categoryName}/${iconName}.svg" 
            alt="${iconName} icon"
            class="w-10 h-10 object-contain"
            loading="lazy"
            onerror="this.style.display='none'; this.nextElementSibling.style.display='block';"
          />
          <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="text-slate-400" style="display:none;">
            <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
          </svg>
        </div>
      </div>
    </div>
  `;
}

// Helper function to render category card
function renderCategoryCard(category: any): string {
  const iconPreviews = category.fileNames?.slice(0, 6).map((fileObj: any, i: number) => {
    const iconName = typeof fileObj === 'string' 
      ? fileObj.replace('.svg', '') 
      : fileObj.fileName?.replace('.svg', '') || `icon-${i}`;
    
    return renderIconPreview(category.name, iconName, i);
  }).join('') || '';

  // Fill remaining slots with empty placeholders
  const remainingSlots = Math.max(0, 6 - (category.fileNames?.length || 0));
  const emptySlots = Array(remainingSlots).fill(0).map(() => 
    '<div class="flex items-center justify-center p-1"><div class="w-14 h-14"></div></div>'
  ).join('');

  return `
    <a
      href="${category.url}"
      class="block bg-white dark:bg-slate-900 dark:border-slate-900 border border-slate-200 rounded-xl p-6 pb-20 shadow-sm hover:shadow-md transition-all duration-200"
    >
      <div class="flex justify-between items-center mb-4">
        <h3 class="text-lg font-bold text-slate-900 dark:text-white capitalize">
          ${category.name.replace('-', ' ')}
        </h3>
        <span class="text-sm text-slate-500 font-medium">
          ${category.iconCount} ICONS
        </span>
      </div>
      
      <div class="grid grid-cols-3 gap-2 gap-y-3 w-full h-20">
        ${iconPreviews}${emptySlots}
      </div>
    </a>
  `;
}

const { categories, currentPage, totalPages, totalCategories, totalSvgIcons, breadcrumbItems } = Astro.props;
---

<ToolContainer>
  <div class="mb-16 mt-[74px]">
    <AdBanner />
  </div>
  <ToolHead
    name="SVG Icons"
    description="Download thousands of free SVG icons instantly. Edit colors, add backgrounds, and customize vector graphics for your projects. No registration required."
    breadcrumbItems={breadcrumbItems}
  />

  <!-- Overview Stats -->
  <div id="pagination-info" class="text-center">
    <div class="grid grid-cols-2 gap-6 mt-8">
      <div class="text-center">
        <div class="text-3xl font-bold text-blue-600">{totalCategories}</div>
        <div class="text-sm text-gray-600 dark:text-gray-400">Categories</div>
      </div>
          <div class="text-center">
            <div class="text-3xl font-bold text-green-600">{formatNumber(totalSvgIcons)}</div>
            <div class="text-sm text-gray-600 dark:text-gray-400">SVG Icons</div>
          </div>
    </div>
  </div>

  <!-- Pagination Info -->
  <div class="bg-slate-50 dark:bg-slate-800 rounded-lg p-4 mb-6 mt-8">
    <div class="text-sm text-slate-600 dark:text-slate-400 text-center">
      Showing {categories.length} of {totalCategories} categories (Page {currentPage} of {totalPages})
    </div>
  </div>

  <!-- Categories Grid -->
  <div class="mt-10 mb-6">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {categories.map((category: any) => (
        <Fragment set:html={renderCategoryCard(category)} />
      ))}
    </div>
  </div>

  <!-- Pagination -->
  <Pagination 
    currentPage={currentPage}
    totalPages={totalPages}
    baseUrl="/freedevtools/svg_icons/"
  />

  <!-- Features -->
  <div class="mb-10 mt-6">
    <ToolContentCardWrapper>
      <Card className="p-6">
        <h2 class="text-xl font-semibold mb-6 text-center">Why Use Our SVG Icons?</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div class="text-center space-y-2">
            <Download className="h-8 w-8 text-blue-600 mx-auto" />
            <h3 class="font-semibold">Instant Download</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Download SVG icons instantly without registration or signup required.
            </p>
          </div>
          <div class="text-center space-y-2">
            <Filter className="h-8 w-8 text-green-600 mx-auto" />
            <h3 class="font-semibold">Easy Customization</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Edit colors, add backgrounds, and customize vector graphics for your projects.
            </p>
          </div>
          <div class="text-center space-y-2">
            <Star className="h-8 w-8 text-yellow-600 mx-auto" />
            <h3 class="font-semibold">High Quality</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">
              Professional vector graphics that scale perfectly for any screen size.
            </p>
          </div>
        </div>
      </Card>
    </ToolContentCardWrapper>
  </div>

  <!-- Credits Section -->
  <div class="mt-10 pt-6 mb-8 border-t border-slate-200 dark:border-slate-700">
    <div class="flex flex-wrap gap-4">
      <a
        href="/freedevtools/"
        class="inline-flex items-center px-4 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 bg-blue-50 dark:bg-blue-900/20 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors"
      >
        â†  Back to Free DevTools
      </a>
      <CreditsButton href="/freedevtools/svg_icons/credits/" />
    </div>
  </div>
</ToolContainer>

<style>
  .icon-preview svg {
    width: 100% !important;
    height: 100% !important;
    max-width: 64px;
    max-height: 64px;
    display: block;
    object-fit: contain;
  }
  
  .icon-preview {
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }
</style>
